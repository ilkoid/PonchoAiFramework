# Production Configuration Template for PonchoAI Framework
# This file provides a comprehensive production configuration with security, performance, and reliability settings

# Framework Configuration
framework:
  name: "PonchoAI Production Framework"
  version: "1.0.0"

  # Production logging configuration
  logging:
    level: "info"  # debug, info, warn, error
    format: "json"  # text, json
    file: "/var/log/ponchoai/app.log"
    rotation:
      max_size: "100MB"
      max_files: 10
      max_age: "7d"
    structured_fields: true  # Enables structured logging for monitoring

  # Security settings
  security:
    enable_content_filtering: true
    max_request_size: "10MB"
    rate_limiting:
      enabled: true
      requests_per_minute: 100
      burst: 20
    cors:
      enabled: true
      allowed_origins: ["https://yourapp.com", "https://api.yourapp.com"]
      allowed_methods: ["GET", "POST", "PUT", "DELETE"]
      allowed_headers: ["Content-Type", "Authorization", "X-API-Key"]

  # Resource management
  resources:
    max_concurrent_requests: 100
    request_timeout: "30s"
    cache:
      enabled: true
      max_size: 1000
      ttl: "1h"
    connection_pool:
      max_connections: 50
      max_idle_connections: 10
      idle_timeout: "90s"

# Model Configurations
models:
  # DeepSeek Models Configuration
  deepseek-chat:
    provider: "deepseek"
    model_name: "deepseek-chat"
    api_key: "${DEEPSEEK_API_KEY}"
    base_url: "https://api.deepseek.com"

    # Production performance settings
    max_tokens: 4000
    temperature: 0.7
    timeout: "30s"

    # Retry and resilience
    retry:
      max_attempts: 3
      backoff: "exponential"
      initial_delay: "100ms"
      max_delay: "5s"

    # Resource limits
    rate_limit:
      requests_per_minute: 60
      burst: 10

    # Monitoring
    metrics:
      enabled: true
      latency_threshold: "2s"
      error_rate_threshold: 0.05

  deepseek-coder:
    provider: "deepseek"
    model_name: "deepseek-coder"
    api_key: "${DEEPSEEK_API_KEY}"
    base_url: "https://api.deepseek.com"

    max_tokens: 8000  # Higher limit for code generation
    temperature: 0.3  # Lower temperature for more deterministic code
    timeout: "45s"    # Longer timeout for complex code tasks

    retry:
      max_attempts: 3
      backoff: "exponential"
      initial_delay: "100ms"
      max_delay: "5s"

    rate_limit:
      requests_per_minute: 40
      burst: 8

  # Z.AI Models Configuration
  glm-vision:
    provider: "zai"
    model_name: "glm-vision"
    api_key: "${ZAI_API_KEY}"
    base_url: "https://api.zai.ai"

    max_tokens: 2000
    temperature: 0.5
    timeout: "60s"  # Longer timeout for vision processing

    retry:
      max_attempts: 2
      backoff: "exponential"
      initial_delay: "200ms"
      max_delay: "10s"

    rate_limit:
      requests_per_minute: 30
      burst: 5

    # Vision-specific settings
    vision:
      max_image_size: "20MB"
      supported_formats: ["jpg", "jpeg", "png", "gif", "webp"]
      resize_threshold: "1024x1024"

  glm-chat:
    provider: "zai"
    model_name: "glm-chat"
    api_key: "${ZAI_API_KEY}"
    base_url: "https://api.zai.ai"

    max_tokens: 4000
    temperature: 0.7
    timeout: "30s"

    retry:
      max_attempts: 3
      backoff: "exponential"
      initial_delay: "100ms"
      max_delay: "5s"

    rate_limit:
      requests_per_minute: 50
      burst: 8

# Tools Configuration
tools:
  # S3 Storage Tool
  s3-storage:
    enabled: true
    provider: "aws"
    region: "${AWS_REGION}"
    bucket: "${S3_BUCKET_NAME}"

    # Security credentials
    access_key_id: "${AWS_ACCESS_KEY_ID}"
    secret_access_key: "${AWS_SECRET_ACCESS_KEY}"

    # Performance settings
    multipart_threshold: "64MB"
    max_retries: 3
    timeout: "30s"

    # Permissions
    allowed_operations: ["read", "write", "delete", "list"]
    path_restrictions:
      allowed_prefixes: ["uploads/", "processed/"]
      denied_prefixes: ["sensitive/", "admin/"]

  # Article Importer Tool
  article-importer:
    enabled: true

    # Content processing
    max_article_size: "5MB"
    supported_formats: ["html", "markdown", "text", "pdf"]

    # External integrations
    integrations:
      wikipedia:
        enabled: true
        api_base: "https://en.wikipedia.org/api/rest_v1"
        timeout: "10s"
        rate_limit: 100  # requests per minute

      news_sources:
        enabled: true
        api_keys:
          newsapi: "${NEWS_API_KEY}"
          guardian: "${GUARDIAN_API_KEY}"
        timeout: "15s"

# Workflow (Flows) Configuration
flows:
  # Content Generation Workflow
  content-generation:
    description: "End-to-end content generation with research and optimization"
    category: "content"

    # Workflow steps
    steps:
      - name: "research"
        model: "deepseek-chat"
        timeout: "30s"
      - name: "draft"
        model: "deepseek-coder"
        timeout: "45s"
      - name: "optimize"
        model: "glm-chat"
        timeout: "30s"

    # Resource limits
    max_duration: "5m"
    max_cost: 0.50  # Maximum cost per execution in USD

    # Error handling
    error_handling:
      strategy: "continue"  # continue, stop, retry
      max_retries: 2
      fallback_models: ["glm-chat"]

  # Image Analysis Workflow
  image-analysis:
    description: "Multi-step image analysis with fashion context"
    category: "vision"

    steps:
      - name: "image-processing"
        model: "glm-vision"
        timeout: "60s"
      - name: "fashion-analysis"
        model: "glm-vision"
        fashion_context:
          enabled: true
          categories: ["clothing", "accessories", "styles"]
      - name: "report-generation"
        model: "deepseek-chat"
        timeout: "30s"

    max_duration: "3m"
    max_cost: 0.30

# Monitoring and Observability
monitoring:
  # Metrics collection
  metrics:
    enabled: true
    collection_interval: "30s"
    retention_period: "7d"
    export_format: "prometheus"

    # Performance thresholds
    thresholds:
      response_time_p95: "2s"
      response_time_p99: "5s"
      error_rate: 0.02
      cpu_usage: 0.80
      memory_usage: 0.85

  # Health checks
  health_checks:
    enabled: true
    interval: "30s"
    timeout: "5s"
    endpoints:
      - "/health"
      - "/ready"
      - "/live"

    # Component health checks
    components:
      models: true
      tools: true
      cache: true
      database: false  # Enable if using database

  # Tracing
  tracing:
    enabled: true
    service_name: "ponchoai-framework"
    jaeger:
      endpoint: "${JAEGER_ENDPOINT:http://localhost:14268/api/traces}"
      sampler:
        type: "probabilistic"
        param: 0.1  # Sample 10% of traces

# Alerting
alerting:
  enabled: true

  # Alert channels
  channels:
    slack:
      webhook_url: "${SLACK_WEBHOOK_URL}"
      channel: "#alerts"
      username: "PonchoAI"

    email:
      smtp_server: "${SMTP_SERVER}"
      smtp_port: 587
      username: "${SMTP_USERNAME}"
      password: "${SMTP_PASSWORD}"
      recipients: ["admin@yourcompany.com"]

  # Alert rules
  rules:
    - name: "High Error Rate"
      condition: "error_rate > 0.05"
      duration: "5m"
      severity: "critical"

    - name: "High Latency"
      condition: "response_time_p95 > 5s"
      duration: "10m"
      severity: "warning"

    - name: "Model Unavailable"
      condition: "model_availability < 0.95"
      duration: "2m"
      severity: "critical"

    - name: "Resource Usage High"
      condition: "memory_usage > 0.90"
      duration: "5m"
      severity: "warning"

# Development and Testing Settings
development:
  # Local development overrides
  debug_mode: false
  mock_external_apis: false

  # Testing configuration
  testing:
    integration_tests:
      enabled: true
      test_models: ["deepseek-chat", "glm-chat"]
      test_timeout: "60s"

    load_testing:
      enabled: false  # Enable for performance testing
      concurrent_users: 50
      duration: "10m"
      ramp_up_time: "2m"

# Environment Variables Required
# ==============================
# Copy these to your .env file or production environment:
#
# API Keys
# DEEPSEEK_API_KEY=your_deepseek_api_key_here
# ZAI_API_KEY=your_zai_api_key_here
#
# AWS (for S3 tool)
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your_aws_access_key_here
# AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here
# S3_BUCKET_NAME=your_s3_bucket_name
#
# News APIs (optional)
# NEWS_API_KEY=your_news_api_key_here
# GUARDIAN_API_KEY=your_guardian_api_key_here
#
# Monitoring
# JAEGER_ENDPOINT=http://your-jaeger-collector:14268/api/traces
#
# Alerting
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/your/webhook/url
# SMTP_SERVER=smtp.yourcompany.com
# SMTP_USERNAME=your_smtp_username
# SMTP_PASSWORD=your_smtp_password